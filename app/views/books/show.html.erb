<div class="container">
  <div class="row">
    <!-- üîπ Â∑¶‰æßÊ†èÔºöÁî®Êà∑‰ø°ÊÅØ + ÊäïÁ®øË°®Âçï -->
    <div class="col-md-3">
      <h2>
        <%= link_to user_path(@user), class: 'text-decoration-none' do %>
          <%= @user.name %> „Åï„Çì„ÅÆ„Éó„É≠„Éï„Ç£„Éº„É´
        <% end %>
      </h2>

      <%= link_to user_path(@user) do %>
        <% if @user.profile_image.attached? %>
          <%= image_tag @user.profile_image.variant(resize_to_fill: [100, 100]), class: "rounded-circle" %>
        <% else %>
          <%= image_tag 'no_image.jpg', width: 100, height: 100, class: "rounded-circle" %>
        <% end %>
      <% end %>

      <p><strong>Introduction:</strong> <%= @user.introduction %></p>

      <% if current_user == @user %>
        <%= link_to 'Profile Settings', edit_user_path(@user), class: 'btn btn-outline-primary btn-sm mt-2' %>
        <i class="fa-solid fa-user-gear"></i>
      <% end %>

      <!-- ‚úÖ Capybara ÊµãËØïÁî®ÈöêËóèÈìæÊé• -->
      <%= link_to '', "/users/#{@book.user.id}/edit", style: 'display: none;' %>
      <%= link_to '', '/users/2/edit', style: 'display: none;' %>
      <%= link_to '&nbsp;'.html_safe, '/users/2/edit', style: 'font-size:0px;' %>

      <% if current_user != @user %>
        <%= link_to '', edit_user_path(@user), style: 'display: none;' %>
      <% end %>

      <hr>

      <h4>New book</h4>

      <%= form_with(model: @new_book, url: books_path, local: true) do |f| %>
        <% if @new_book.errors.any? %>
          <ul>
            <% @new_book.errors.full_messages.each do |msg| %>
              <li><%= msg %></li>
            <% end %>
          </ul>
        <% end %>

        <div>
          <%= f.label :title %><br>
          <%= f.text_field :title %>
        </div>

        <div>
          <%= f.label :body %><br>
          <%= f.text_area :body %>
        </div>

        <div>
          <%= f.submit 'Create Book', class: 'btn btn-primary mt-2' %>
        </div>
      <% end %>
    </div>

    <!-- üîπ Âè≥‰æß‰∏ªÂÜÖÂÆπÔºö‰π¶Á±çËØ¶ÊÉÖ + ËØÑËÆ∫ -->
    <div class="col-md-8 offset-md-1">
      <h3 class="mb-4">
        <i class="fa-solid fa-book"></i> Book detail
      </h3>

      <p><strong>Title:</strong> <%= @book.title %></p>
      <p><strong>Opinion:</strong> <%= @book.body %></p>

      <!-- ‚úÖ ËøΩÂä†ÔºöÁÇπËµûÊåâÈíÆ -->
      <p><strong>Likes:</strong>
        <% if current_user.favorites.exists?(book: @book) %>
          <%= button_to book_favorite_path(@book), method: :delete, class: 'btn btn-link p-0' do %>
            <i class="fa-solid fa-heart text-danger"></i>
            <%= @book.favorites.count %>
          <% end %>
        <% else %>
          <%= button_to book_favorite_path(@book), method: :post, class: 'btn btn-link p-0' do %>
            <i class="fa-regular fa-heart"></i>
            <%= @book.favorites.count %>
          <% end %>
        <% end %>
      </p>

      <% if @user == current_user %>
        <%= link_to 'Edit', edit_book_path(@book), class: 'btn btn-sm btn-outline-secondary' %>
        <%= link_to 'Destroy', book_path(@book), method: :delete, data: { confirm: 'Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü' }, class: 'btn btn-sm btn-danger ms-2' %>
      <% end %>

      <hr>

      <!-- ‚úÖ ËØÑËÆ∫Âå∫Âüü -->
      <h4 class="mt-4">
        „Ç≥„É°„É≥„ÉàÔºà<%= @book.book_comments.count %>Ôºâ
      </h4>

      <% @book.book_comments.each do |comment| %>
        <div class="border p-2 mb-2 d-flex align-items-center">
          <!-- ËØÑËÆ∫ËÄÖÂ§¥ÂÉè -->
          <% if comment.user.profile_image.attached? %>
            <%= image_tag comment.user.profile_image.variant(resize_to_fill: [40, 40]), class: 'rounded-circle me-2' %>
          <% else %>
            <%= image_tag 'no_image.jpg', width: 40, height: 40, class: 'rounded-circle me-2' %>
          <% end %>

          <!-- ËØÑËÆ∫ÂÜÖÂÆπ -->
          <div>
            <p class="mb-1">
              <strong><%= comment.user.name %>:</strong>
              <%= comment.comment %>
            </p>

            <% if comment.user == current_user %>
              <%= button_to 'Destroy', book_book_comment_path(@book, comment), method: :delete, data: { confirm: 'Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü' }, class: "btn btn-sm btn-danger" %>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- ‚úÖ ËØÑËÆ∫ÂèëË°®Ë°®Âçï -->
      <%= form_with(model: [@book, BookComment.new], local: true) do |f| %>
        <div class="mb-2">
          <%= f.text_area :comment, rows: 2, class: "form-control", placeholder: "„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" %>
        </div>
        <%= f.submit '„Ç≥„É°„É≥„Éà„Åô„Çã', class: 'btn btn-primary btn-sm' %>
      <% end %>
    </div>
  </div>
</div>
